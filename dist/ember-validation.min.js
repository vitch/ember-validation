// Ember Validation
// Â© 2013 Daniel Kuczewski
// Licensed under MIT license
// build date: 15-09-2014
!function(a){if("undefined"==typeof Ember)throw new Error("Ember not found");Ember.Validation=Ember.Namespace.create(),"undefined"==typeof EV&&(EV=Ember.Validation,"undefined"!=typeof a&&"undefined"!=typeof a.EV&&(a.EV=Ember.Validation)),Ember.Validation.toType=function(a){return{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},Ember.Validation.humanize=function(a){return a.replace(/_id$/,"").replace(/_/g," ").replace(/^\w/g,function(a){return a.toUpperCase()})}}(this),function(){Ember.Validation.defaultMessages={invalid:"%@1 is invalid",mail:"%@1 is invalid mail address",required:"%@1 is required",equals:"%@1 must be equal to %@2",number:"%@1 must be a number",integer:"%@1 must be an integer",min:"%@1 must be greater than or equal to %@2",max:"%@1 must be less than or equal to %@2",range:"%@1 must be in the range of %@2 and %@3",string:"%@1 must be a string",minLength:"%@1 must be at least %@2 characters",maxLength:"%@1 must be at most %@2 characters",textLength:"%@1 must be between %@2 and %@3 characters"}}(this),function(){var a=Ember.get,b=Ember.String.fmt,c=Ember.Validation.toType,d=Ember.Validation.defaultMessages;Ember.Validation.BaseRule=Ember.Object.extend({propertyName:null,message:d.invalid,parameters:null,_validate:function(a,b){var c={isValid:!0,error:"",override:!1},d=this.getParameters(b);return c.isValid=this.validate.apply(this,[a].concat(d,[b])),c.isValid||(c.error=this.getError(d)),c.override=this.override.apply(this,[a,c.isValid].concat(d,[b])),c},validate:function(){throw new Error("BaseRule validate() must be overwritten")},override:function(){return!1},getError:function(c){return b(a(this,"message"),[a(this,"propertyName")].concat(c))},getParameters:function(b){var d=[],e=a(this,"parameters");if(!e&&"array"!==c(e))return[];for(var f=0;f<e.length;f++)d.push(this._processParameter(e[f],b));return d},_processParameter:function(a,b){return"function"===c(a)?a.call(b):a}})}(this),function(){toType=Ember.Validation.toType,msgs=Ember.Validation.defaultMessages,Ember.Validation.MatchRule=Ember.Validation.BaseRule.extend({validate:function(a,b){return"string"!==toType(a)?!1:b.test(a)}}),Ember.Validation.NoMatchRule=Ember.Validation.MatchRule.extend({validate:function(a,b){return!this._super(a,b)}}),Ember.Validation.MailRule=Ember.Validation.MatchRule.extend({parameters:[/^(([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/],message:msgs.mail})}(this),function(){toType=Ember.Validation.toType,msgs=Ember.Validation.defaultMessages,Ember.Validation.NumberRule=Ember.Validation.BaseRule.extend({message:msgs.number,validate:function(a){return!isNaN(a)&&!isNaN(parseFloat(a))}}),Ember.Validation.IntegerRule=Ember.Validation.NumberRule.extend({message:msgs.integer,validate:function(a){if(!this._super(a))return!1;var b=parseFloat(a);return"number"===toType(b)&&b%1===0}}),Ember.Validation.NumberMinRule=Ember.Validation.NumberRule.extend({message:msgs.min,validate:function(a,b){return this._super(a)?parseFloat(a)>=b:!1}}),Ember.Validation.NumberMaxRule=Ember.Validation.NumberRule.extend({message:msgs.max,validate:function(a,b){return this._super(a)?parseFloat(a)<=b:!1}}),Ember.Validation.NumberRangeRule=Ember.Validation.NumberRule.extend({message:msgs.range,validate:function(a,b,c){return this._super(a)?parseFloat(a)>=b&&parseFloat(a)<=c:!1}})}(this),function(){var a=Ember.get,b=Ember.Validation.toType,c=Ember.Validation.defaultMessages;Ember.Validation.StringRule=Ember.Validation.BaseRule.extend({message:c.string,validate:function(a){return"string"!==b(a)}}),Ember.Validation.TextMinLengthRule=Ember.Validation.BaseRule.extend({message:c.minLength,validate:function(c,d){if("string"!==b(c))return!1;var e=a(c,"length")||0;return e>=d}}),Ember.Validation.TextMaxLengthRule=Ember.Validation.BaseRule.extend({message:c.maxLength,validate:function(c,d){if("string"!==b(c))return!1;var e=a(c,"length")||0;return d>=e}}),Ember.Validation.TextLengthRule=Ember.Validation.BaseRule.extend({message:c.textLength,validate:function(c,d,e){if("string"!==b(c))return!1;var f=a(c,"length")||0;return f>=d&&e>=f}})}(this),function(){var a=Ember.get,b=Ember.Validation.toType,c=Ember.Validation.defaultMessages;Ember.Validation.RequiredRule=Ember.Validation.BaseRule.extend({message:c.required,validate:function(a,b){return Ember.isEmpty(a)?!b:!0},override:function(a,b,c){return Ember.isEmpty(a)&&!c}}),Ember.Validation.EqualsRule=Ember.Validation.BaseRule.extend({message:c.equals,validate:function(a,b){return a===b}}),Ember.Validation.CustomRule=Ember.Validation.BaseRule.extend({_validate:function(c,d){var e={isValid:!0,error:"",override:!1},f=a(this,"parameters"),g=f.length>0?f[0]:null;if("function"!==b(g))throw new Error("CustomRule parameter must be function");return e.isValid=g.call(d,c),e.isValid||(e.error=this.getError([])),e}})}(this),function(){var a=Ember.get,b=Ember.set,c=Ember.Validation.toType;Ember.Validation.Result=Ember.Object.extend({error:null,setError:function(a){b(this,"error",a)},hasError:Ember.computed(function(){return"string"===c(a(this,"error"))}).property("error"),isValid:Ember.computed.not("hasError")}),Ember.Validation.ValidationResult=Ember.Object.extend({results:null,init:function(){this._super(),b(this,"results",Ember.Map.create())},clear:function(){var b=a(this,"results");b.forEach(function(a,b){Ember.Validation.ValidationResult.detectInstance(b)?b.clear():Ember.Validation.Result.detectInstance(b)&&b.set("error",null)}),this.notifyPropertyChange("results")},getPropertyResult:function(b){return a(this,"results").get(b)||Ember.Validation.Result.create()},setPropertyResult:function(b,c){var d=a(this,"results");d.set(b,c),this.notifyPropertyChange("results")},hasError:Ember.computed(function(){return!!a(this,"errorLength")}).property("results"),isValid:Ember.computed.not("hasError"),properties:Ember.computed(function(){var b=Ember.A();return a(this,"results").forEach(function(a){b.pushObject(a)}),b}).property("results"),errorProperties:Ember.computed(function(){var b=Ember.A();return a(this,"results").forEach(function(c,d){a(d,"hasError")&&b.pushObject(c)}),b}).property("results"),error:Ember.computed(function(){return a(this,"hasError")?a(this,"errors")[0]:null}).property("results"),errors:Ember.computed(function(){var b=Ember.A();return a(this,"results").forEach(function(c,d){a(d,"hasError")&&(Ember.Validation.ValidationResult.detectInstance(d)?b.pushObjects(a(d,"errors")):Ember.Validation.Result.detectInstance(d)&&b.pushObject(a(d,"error")))}),b}).property("results"),length:Ember.computed(function(){var b=0;return a(this,"results").forEach(function(){b++}),b}).property("results"),errorLength:Ember.computed(function(){var b=0;return a(this,"results").forEach(function(c,d){a(d,"hasError")&&b++}),b}).property("results"),merge:function(b){var c=this;a(b,"results").forEach(function(a,b){c.setPropertyResult(a,b)})},unknownProperty:function(a){return this.getPropertyResult(a)}})}(this),function(){var a=Ember.get,b=Ember.set;Ember.Validation.ValueValidator=Ember.Object.extend({rules:null,init:function(){this._super(),b(this,"rules",[])},addRule:function(b){a(this,"rules").push(b)},validate:function(b,c){for(var d=Ember.Validation.Result.create(),e=a(this,"rules"),f=0;f<e.length;f++){var g=e[f]._validate(b,c);if(!g.isValid||g.override){g.isValid||d.setError(g.error);break}}return d}})}(this),function(){var a=Ember.get,b=Ember.set,c=Ember.Validation.toType;Ember.Validation.ObjectValidator=Ember.Object.extend({validators:null,init:function(){this._super(),b(this,"validators",Ember.Map.create())},setPropertyValidator:function(b,c){return a(this,"validators").set(b,c),c},getPropertyValidator:function(b){return a(this,"validators").get(b)},hasPropertyValidator:function(b){return a(this,"validators").has(b)},createResult:function(){var b=Ember.Validation.ValidationResult.create(),c=[];a(this,"validators").forEach(function(a){c.push(a)});for(var d=0;d<a(c,"length");d++)b.setPropertyResult(c[d],Ember.Validation.Result.create());return b},validate:function(b,d){var e,f=this.createResult(),g=!0;if("boolean"===c(d)&&(g=d),"string"===c(d))return e=this.validateProperty(b,d,f),f.setPropertyResult(d,e),f;var h=[];if("array"===c(d))h=d;else{var i=a(this,"validators");i.forEach(function(a){h.push(a)})}for(var j=0;j<a(h,"length")&&(e=this.validateProperty(b,h[j]),f.setPropertyResult(h[j],e),a(e,"isValid")||g);j++);return f},validateProperty:function(b,c){if(this.hasPropertyValidator(c)){var d=this.getPropertyValidator(c);if(Ember.Validation.ValueValidator.detectInstance(d))return d.validate(a(b,c),b);if(Ember.Validation.ObjectValidator.detectInstance(d))return d.validate(a(b,c))}return null}})}(this),function(){var a=Ember.get,b=Ember.set,c=Ember.Validation.toType,d=Ember.Validation.humanize;Ember.Validation.Chaining=Ember.Object.extend({propertyName:null,isRequired:!1,requiredErrorMessage:null,errorMessage:null,chain:null,init:function(){this._super(),b(this,"chain",[])},required:function(a){return Ember.isNone(a)&&(a=!0),b(this,"isRequired",a),this},message:function(c){var d=a(this,"chain").slice(-1)[0];if(d)d.message=c;else{var e=a(this,"isRequired");"function"===Ember.Validation.toType(e)&&(e=e()),e?b(this,"requiredErrorMessage",c):b(this,"errorMessage",c)}return this},createValueValidator:function(){var d=Ember.Validation.ValueValidator.create(),e=a(this,"propertyName"),f=a(this,"errorMessage"),g=a(this,"requiredErrorMessage"),h=a(this,"isRequired");h="function"===Ember.Validation.toType(h)?h:!!h;var i=Ember.Validation.RequiredRule.create({propertyName:e,parameters:[h]});"string"===c(g)?b(i,"message",g):"string"===c(f)&&b(i,"message",f),d.addRule(i);for(var j=a(this,"chain"),k=0;k<j.length;k++){var l=j[k],m=l.ruleClass.create({propertyName:e});l.parameters&&l.parameters.length>0&&b(m,"parameters",l.parameters),"string"===c(l.message)?b(m,"message",l.message):"string"===c(f)&&b(m,"message",f),d.addRule(m)}return d},done:function(){return this.createValueValidator()}}),Ember.Validation.ChainingContext=Ember.Object.extend({items:null,init:function(){this._super(),b(this,"items",{})},property:function(b,c){var e=Ember.Validation.Chaining.create({propertyName:c||d(b)});return a(this,"items")[b]=e,e},nested:function(b,c){Ember.Validation.ObjectValidator.detect(c)||(c=c.proto().validator),Ember.Validation.ObjectValidator.detect(c)&&(a(this,"items")[b]=c)},createObjectValidator:function(){var b=Ember.Validation.ObjectValidator.create(),c=a(this,"items");for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];Ember.Validation.Chaining.detectInstance(e)&&(e=e.createValueValidator()),(Ember.Validation.ValueValidator.detectInstance(e)||Ember.Validation.ObjectValidator.detectInstance(e))&&b.setPropertyValidator(d,e)}return b}}),Ember.Validation.createValueValidator=function(a){return Ember.Validation.Chain.create({propertyName:a})},Ember.Validation.createObjectValidator=function(a){var b=Ember.Validation.ChainingContext.create();return a.call(b),b.createObjectValidator()},Ember.Validation.map=Ember.Validation.createObjectValidator}(this),function(){var a=Ember.get;Ember.Validation.registerRule=function(b,c){if(!c){var d=b.charAt(0).toUpperCase()+b.slice(1)+"Rule";if(c=Ember.Validation[d],!c)throw new Error("Rule for method "+b+" not found")}if(!Ember.Validation.BaseRule.detect(c))throw new Error("Rule for method "+b+" must extend from Ember.Validation.BaseRule");var e={};e[b]=function(){return a(this,"chain").push({ruleClass:c,parameters:Array.prototype.slice.call(arguments,0),message:null}),this},Ember.Validation.Chaining.reopen(e)};var b={number:Ember.Validation.NumberRule,integer:Ember.Validation.IntegerRule,min:Ember.Validation.NumberMinRule,max:Ember.Validation.NumberMaxRule,range:Ember.Validation.NumberRangeRule,custom:Ember.Validation.CustomRule,noMatch:Ember.Validation.NoMatchRule,match:Ember.Validation.MatchRule,string:Ember.Validation.StringRule,mail:Ember.Validation.MailRule,length:Ember.Validation.TextLengthRule,minLength:Ember.Validation.TextMinLengthRule,maxLength:Ember.Validation.TextMaxLengthRule,equals:Ember.Validation.EqualsRule};for(var c in b)b.hasOwnProperty(c)&&Ember.Validation.registerRule(c,b[c])}(this),function(){var a=Ember.get,b=(Ember.set,Ember.Validation.toType);Ember.Validation.ValidatorSupport=Ember.Mixin.create(Ember.Evented,{isValidated:!1,validator:null,didValidate:Ember.K,init:function(){this._super();var b=a(this,"validator");b?Ember.Validation.ObjectValidator.detect(b.constructor)||Ember.Logger.warn("The validator property must be a subclass of ObjectValidator"):Ember.Logger.warn("Add validator property when using the ValidatorSupport mixin"),b&&this.set("validationResult",b.createResult())},hasPropertyValidator:function(b){return a(this,"validator").hasPropertyValidator(b)},isValid:function(){return a(this,"validationResult.isValid")}.property().volatile(),hasError:Ember.computed.not("isValid"),validate:function(b){var c=a(this,"validator").validate(this,b),d=a(this,"validationResult");return d.merge(c),this.notifyPropertyChange("validationResult"),this.triggerValidation(c),this.set("isValidated",!0),c},prevalidate:function(b){return a(this,"validator").validate(this,b)},validateProperty:function(b){return a(this,"validator").validateProperty(this,b)},clearValidation:function(){var b=a(this,"validationResult");b.clear(),this.notifyPropertyChange("validationResult"),this.triggerValidation(b),this.set("isValidated",!1)},triggerValidation:function(b){var c=this;a(b,"results").forEach(function(a,b){c.trigger("v_event"+a,b,c)}),c.trigger("v_event",b,c)},subscribeValidation:function(a,c,d){"object"===b(a)?(d=c,c=a,a=""):"function"===b(a)&&(d=a,c=null,a=""),this.on("v_event"+a,c,d)},unsubscribeValidation:function(a,c,d){"object"===b(a)?(d=c,c=a,a=""):"function"===b(a)&&(d=a,c=null,a=""),this.off("v_event"+a,c,d)}})}(this),function(){var a=Ember.get,b=Ember.set,c=Ember.Validation.toType;Ember.Validation.ValidatorViewSupport=Ember.Mixin.create({validationObject:null,validationProperty:null,willValidate:Ember.K,didValidate:Ember.K,init:function(){this._super();var d=a(this,"validationObject"),e=a(this,"validationProperty");if("object"!==c(d)&&"string"===c(e)&&(d=null),"string"!==c(e)&&(e=null),!d){var f=a(this,"valueBinding");if(f){var g=f._from;if(g){var h=g.lastIndexOf(".");-1!==h?(e=g.substr(h+1),d=a(this,g.substr(0,h))):(e=g,d=a(this,"context"))}}}d&&"function"===c(d.validate)&&e?(b(this,"validationProperty",e),b(this,"validationObject",d)):Ember.ObjectController.detectInstance(d)&&"function"===c(d.get("model.validate"))&&e?(b(this,"validationProperty",e),b(this,"validationObject",d.get("model"))):(b(this,"validationProperty",null),b(this,"validationObject",null),Ember.warn("ValidatorViewSupport needs either a validationObject/validationProperty or a valueBinding which binds toward a ValidatorSupport mixin"))},validate:function(){var b=a(this,"validationObject"),c=a(this,"validationProperty");if(b){var d=b.validateProperty(c);return this.doValidate(d),d}return null},didInsertElement:function(){this._super();var b=a(this,"validationObject"),c=a(this,"validationProperty");b&&b.subscribeValidation(c,this,a(this,"doValidate"))},willDestroyElement:function(){this._super();var b=a(this,"validationObject"),c=a(this,"validationProperty");b&&b.unsubscribeValidation(c,this,a(this,"doValidate"))},doValidate:function(a){var d=this.willValidate();("boolean"!==c(d)||d)&&(b(this,"validationResult",a),this.didValidate(a))}})}(this);